<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doce Ess√™ncia Confeitaria üç∞‚ú®</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Vari√°veis de Cores Vibrantes e Tem√°ticas */
        :root {
            --primary-color: #FF69B4; /* Rosa Vibrante - Doce Ess√™ncia */
            --secondary-color: #8A2BE2; /* Azul Violeta - Toque M√°gico */
            --accent-color: #FFD700; /* Dourado/Amarelo - Brilho */
            --background-light: #FFF0F5; /* Rosa Claro - Suave e Convidativo */
            --text-color: #333;
            --text-light: #fff;
            --border-color: #FFB6C1; /* Rosa claro para bordas */
            --card-background: #FFFFFF;
            --success-color: #28a745; /* Verde para sucesso */
            --error-color: #dc3545; /* Vermelho para erro */
            --warning-color: #ffc107; /* Amarelo para aviso */
            --hover-dark: #FF1493; /* Rosa mais escuro para hover */
            --gradient-bg: linear-gradient(135deg, var(--background-light), #FFE4E1); /* Gradiente suave */
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --button-gradient: linear-gradient(45deg, var(--primary-color), var(--hover-dark));
            --button-hover-gradient: linear-gradient(45deg, var(--hover-dark), var(--primary-color));
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background: var(--gradient-bg); /* Fundo com gradiente suave */
            color: var(--text-color);
            display: flex;
            min-height: 100vh;
            overflow: hidden; /* Controla o overflow do corpo principal */
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-color); /* Cor principal */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: var(--text-light);
            font-size: 1.5em;
            opacity: 1;
            transition: opacity 1s ease-out;
        }

        .splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .splash-logo {
            width: 180px;
            height: 180px;
            border-radius: 50%; /* Borda circular para um visual mais doce */
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }

        .spinner {
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid var(--accent-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .splash-text {
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        /* App Container */
        .app {
            display: flex;
            width: 100%;
            height: 100vh;
        }

        .app.hidden {
            display: none;
        }

        /* Sidebar (Menu Lateral) */
        .sidebar {
            width: 250px;
            background: var(--secondary-color); /* Cor secund√°ria vibrante */
            color: var(--text-light);
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
            border-right: 2px solid var(--primary-color); /* Destaque na borda */
        }

        .sidebar .logo {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px dashed rgba(255, 255, 255, 0.3); /* Linha divis√≥ria divertida */
            padding-bottom: 20px;
        }

        .sidebar .logo h1 {
            font-size: 1.8em;
            margin: 0;
            color: var(--accent-color); /* T√≠tulo em destaque */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .sidebar .logo p {
            font-size: 0.9em;
            margin: 5px 0 0;
            opacity: 0.8;
        }

        .main-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .main-nav li {
            margin-bottom: 10px;
        }

        .nav-button {
            background: none;
            border: none;
            color: var(--text-light);
            padding: 12px 15px;
            width: 100%;
            text-align: left;
            font-size: 1.1em;
            cursor: pointer;
            border-radius: 8px; /* Cantos mais suaves */
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
        }

        .nav-button i {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .nav-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateX(5px); /* Efeito de "sa√≠da" */
        }

        .nav-button.active {
            background-color: var(--primary-color); /* Cor ativa mais vibrante */
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .user-info {
            margin-top: auto; /* Empurra para o final da sidebar */
            padding-top: 20px;
            border-top: 1px dashed rgba(255, 255, 255, 0.3);
            text-align: center;
            opacity: 0.9;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-info i {
            margin-right: 8px;
            font-size: 1.5em;
            color: var(--accent-color);
        }


        /* Main Content Area */
        .content {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto; /* Habilita rolagem para o conte√∫do */
            background: var(--background-light);
        }

        .content section {
            background: var(--card-background);
            padding: 25px 30px;
            border-radius: 12px; /* Cantos arredondados para as se√ß√µes */
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            display: none;
            animation: fadeIn 0.5s ease-out; /* Anima√ß√£o de fade-in */
        }

        .content section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content h2 {
            color: var(--primary-color); /* T√≠tulos em rosa vibrante */
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .content h2 i {
            margin-right: 10px;
            color: var(--secondary-color);
        }

        /* Dashboard Specific Styles */
        .dashboard-summary {
            background-color: #FFDAB9; /* P√™ssego claro */
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            font-style: italic;
            color: #6A5ACD; /* Roxo suave */
            border: 1px dashed #FFC0CB; /* Rosa beb√™ */
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .dashboard-card:hover {
            transform: translateY(-5px); /* Efeito de "levita√ß√£o" */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .dashboard-card h3 {
            margin-top: 0;
            color: var(--secondary-color); /* T√≠tulos de card em azul violeta */
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; /* Espa√ßo entre texto e emoji/√≠cone */
        }

        .dashboard-card p {
            font-size: 2em;
            margin: 10px 0 0;
            font-weight: bold;
            color: var(--primary-color);
        }

        .dashboard-card.ganhos p { color: var(--success-color); }
        .dashboard-card.gastos p { color: var(--error-color); }
        .dashboard-card.lucro p { color: var(--secondary-color); font-size: 2.2em; }
        .dashboard-card.clientes p { color: #5cb85c; }
        .dashboard-card.produtos p { color: #f0ad4e; }


        .dashboard-list-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .dashboard-list-card {
            background: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .dashboard-list-card h3 {
            margin-top: 0;
            color: var(--secondary-color);
            font-size: 1.1em;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .dashboard-list-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .dashboard-list-card li {
            padding: 8px 0;
            border-bottom: 1px dotted rgba(0, 0, 0, 0.1);
            font-size: 0.95em;
            color: #555;
        }

        .dashboard-list-card li:last-child {
            border-bottom: none;
        }

        .dashboard-list-card.estoque-baixo li {
            color: var(--error-color); /* Itens em falta em vermelho */
            font-weight: bold;
        }

        .dashboard-list-card.proximos-pedidos li {
            color: var(--secondary-color); /* Pedidos pr√≥ximos em azul violeta */
            font-weight: 500;
        }


        /* Shared Styles (Forms, Tables, Buttons) */

        /* Buttons */
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .add-button {
            background: var(--button-gradient);
            color: var(--text-light);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-button:hover {
            background: var(--button-hover-gradient);
            transform: translateY(-2px);
        }

        .add-small-button { /* Para "Adicionar Produto ao Pedido" e "Adicionar Ingrediente" */
            background-color: #90EE90; /* Verde claro */
            color: #333;
            border: 1px solid #6B8E23;
            padding: 8px 12px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .add-small-button:hover {
            background-color: #7CFC00; /* Verde mais vivo */
        }

        .cancel-button {
            background-color: #FFC0CB; /* Rosa beb√™ */
            color: var(--text-color);
            border: 1px solid var(--primary-color);
        }

        .cancel-button:hover {
            background-color: var(--primary-color);
            color: var(--text-light);
        }

        .edit-button {
            background-color: var(--accent-color); /* Dourado */
            color: var(--text-color);
            padding: 6px 10px;
            font-size: 0.85em;
        }

        .edit-button:hover {
            background-color: #FFD700;
            transform: scale(1.05);
        }

        .delete-button {
            background-color: var(--error-color);
            color: var(--text-light);
            padding: 6px 10px;
            font-size: 0.85em;
        }

        .delete-button:hover {
            background-color: #CC0000;
            transform: scale(1.05);
        }

        /* Forms */
        .form-container {
            background: #FFFBFB; /* Quase branco com um toque de rosa */
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            margin-top: 25px;
            border: 1px solid var(--border-color);
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-container h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
        }

        .form-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-container input[type="text"],
        .form-container input[type="number"],
        .form-container input[type="email"],
        .form-container input[type="date"],
        .form-container select,
        .form-container textarea {
            width: calc(100% - 22px); /* Ajusta o padding */
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-container input:focus,
        .form-container select:focus,
        .form-container textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.2);
            outline: none;
        }

        .form-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }

        .form-buttons button[type="submit"] {
            background: var(--primary-color);
            color: var(--text-light);
            font-weight: bold;
        }

        .form-buttons button[type="submit"]:hover {
            background: var(--hover-dark);
        }

        .add-ingrediente-form, .add-produto-ao-pedido-form {
            background-color: #F8F8FF; /* GosthWhite */
            border: 1px solid #E6E6FA; /* LavenderBlush */
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            align-items: flex-end;
        }

        .add-ingrediente-form label, .add-produto-ao-pedido-form label {
            margin-bottom: 0;
        }

        .add-ingrediente-form button, .add-produto-ao-pedido-form button {
            grid-column: span 2; /* Ocupa as duas colunas */
            justify-self: end;
        }

        /* Lists (ul) within forms for items */
        #listaItensPedido, #listaIngredientesProdutoFinal {
            list-style: none;
            padding: 0;
            margin-top: 15px;
            border: 1px dashed var(--border-color);
            border-radius: 8px;
            padding: 10px;
            background-color: #FFF5EE; /* Seafood White */
        }

        #listaItensPedido li, #listaIngredientesProdutoFinal li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dotted rgba(0, 0, 0, 0.1);
            font-size: 0.9em;
        }

        #listaItensPedido li:last-child, #listaIngredientesProdutoFinal li:last-child {
            border-bottom: none;
        }

        #listaItensPedido .remove-item-btn, #listaIngredientesProdutoFinal .remove-item-btn {
            background: none;
            border: none;
            color: var(--error-color);
            cursor: pointer;
            font-size: 1.2em;
            padding: 0 5px;
        }

        #totalPedidoDisplay, #custoProducaoInput {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1em;
            margin-top: 15px;
            display: block;
            text-align: right;
            padding-right: 10px;
        }

        /* Tables */
        .table-container {
            overflow-x: auto; /* Permite rolagem horizontal em tabelas pequenas */
            margin-top: 25px;
            background: var(--card-background);
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table thead {
            background-color: var(--secondary-color); /* Cabe√ßalho da tabela vibrante */
            color: var(--text-light);
        }

        table th {
            padding: 12px 15px;
            text-align: left;
            font-weight: bold;
        }

        table tbody tr {
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s ease;
        }

        table tbody tr:nth-child(even) {
            background-color: #FDF5F6; /* Listra suave */
        }

        table tbody tr:hover {
            background-color: #FFE5EE; /* Rosa claro ao passar o mouse */
        }

        table td {
            padding: 10px 15px;
            vertical-align: middle;
        }

        table td button {
            margin-right: 5px;
        }

        /* Search Bar */
        .section-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap; /* Permite quebrar linha em telas pequenas */
            gap: 15px;
        }

        .search-container {
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background-color: #fff;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .search-container input[type="text"] {
            border: none;
            padding: 8px 12px;
            flex-grow: 1;
            font-size: 0.95em;
            margin-bottom: 0; /* Remove margin-bottom padr√£o */
        }

        .search-container input[type="text"]:focus {
            outline: none;
            box-shadow: none; /* Remove box-shadow extra ao focar */
        }

        .clear-search-button {
            background: none;
            border: none;
            color: #999;
            padding: 0 10px;
            cursor: pointer;
            font-size: 1.2em;
            height: 100%;
            align-self: stretch; /* Estica para preencher a altura */
            transition: color 0.2s ease;
        }

        .clear-search-button:hover {
            color: var(--error-color);
        }


        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1001; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%; /* Could be more responsive */
            max-width: 500px;
            border-radius: 15px; /* Mais arredondado */
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            position: relative;
            text-align: center;
            animation: zoomIn 0.3s ease-out;
        }

        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
        }

        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-message {
            margin-bottom: 25px;
            font-size: 1.1em;
            color: var(--text-color);
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .confirm-button {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
        }

        .confirm-button:hover {
            background-color: var(--hover-dark);
        }

        /* Agenda specific styles */
        .agenda-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #agendaCalendar {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            background-color: var(--card-background);
            box-shadow: var(--card-shadow);
            /* Placeholder para um estilo de calend√°rio mais elaborado se for adicionado */
            min-height: 200px; /* Para visualizar o espa√ßo */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #888;
        }

        #agendaPedidosList {
            list-style: none;
            padding: 0;
            margin: 0;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background-color: var(--card-background);
            box-shadow: var(--card-shadow);
        }

        #agendaPedidosList li {
            padding: 12px 20px;
            border-bottom: 1px dotted #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95em;
        }

        #agendaPedidosList li:last-child {
            border-bottom: none;
        }

        #agendaPedidosList li span {
            font-weight: bold;
            color: var(--secondary-color);
        }

        /* Responsividade B√°sica */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                padding: 15px;
                position: relative;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .main-nav ul {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }

            .main-nav li {
                margin-bottom: 0;
            }

            .nav-button {
                width: auto;
                padding: 10px 12px;
                font-size: 0.9em;
            }

            .sidebar .logo, .user-info {
                display: none; /* Esconde logo e user info em telas pequenas */
            }

            .content {
                padding: 20px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr; /* Uma coluna em telas menores */
            }

            .dashboard-list-section {
                grid-template-columns: 1fr;
            }

            .section-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .search-container {
                width: 100%;
            }

            .form-container input,
            .form-container select,
            .form-container textarea {
                width: calc(100% - 20px);
            }
        }
    </style>
</head>
<body>
    <div id="splash-screen" class="splash-screen">
        <img src="https://via.placeholder.com/150/FF69B4/FFFFFF?text=Doce+Ess%C3%AAncia" alt="Logo Doce Ess√™ncia" class="splash-logo">
        <div class="spinner"></div>
        <p class="splash-text">Preparando as del√≠cias... üßÅ</p>
    </div>

    <div id="app" class="app hidden">
        <aside class="sidebar">
            <div class="logo">
                <h1>Doce Ess√™ncia üíñ</h1>
                <p>Gest√£o Ado√ßada!</p>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><button id="navDashboard" class="nav-button active"><i class="fas fa-home"></i> Dashboard üìä</button></li>
                    <li><button id="navClientes" class="nav-button"><i class="fas fa-users"></i> Clientes üßë‚Äçü§ù‚Äçüßë</button></li>
                    <li><button id="navPedidos" class="nav-button"><i class="fas fa-shopping-basket"></i> Pedidos üìù</button></li>
                    <li><button id="navProdutos" class="nav-button"><i class="fas fa-cake-candles"></i> Produtos Finais üéÇ</button></li>
                    <li><button id="navEstoque" class="nav-button"><i class="fas fa-warehouse"></i> Estoque üì¶</button></li>
                    <li><button id="navDespesas" class="nav-button"><i class="fas fa-coins"></i> Despesas üí∏</button></li>
                    <li><button id="navAgenda" class="nav-button"><i class="fas fa-calendar-alt"></i> Agenda üóìÔ∏è</button></li>
                </ul>
            </nav>
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span>Ol√°, Chefinho(a)! üëã</span>
            </div>
        </aside>

        <main class="content">
            <section id="dashboard" class="active">
                <h2>Seu Cantinho Doce üç∞ - Dashboard</h2>
                <div class="dashboard-summary">
                    <p>Vis√£o geral do seu sucesso neste m√™s! ‚ú®</p>
                </div>
                <div class="dashboard-grid">
                    <div class="dashboard-card financeiro ganhos">
                        <h3>Ganhos do M√™s üí∞</h3>
                        <p id="dashboardGanhos">R$ 0,00</p>
                    </div>
                    <div class="dashboard-card financeiro gastos">
                        <h3>Gastos do M√™s üìâ</h3>
                        <p id="dashboardGastos">R$ 0,00</p>
                    </div>
                    <div class="dashboard-card financeiro lucro">
                        <h3>Lucro do M√™s üéâ</h3>
                        <p id="dashboardLucro">R$ 0,00</p>
                    </div>
                    <div class="dashboard-card info clientes">
                        <h3>Total Clientes üë•</h3>
                        <p id="totalClientes">0</p>
                    </div>
                    <div class="dashboard-card info produtos">
                        <h3>Total Produtos Finais üéÇ</h3>
                        <p id="totalProdutosFinais">0</p>
                    </div>
                </div>

                <div class="dashboard-list-section">
                    <div class="dashboard-list-card estoque-baixo">
                        <h3>Estoque Precisando de Amor ‚ù§Ô∏è</h3>
                        <ul id="estoqueBaixoList">
                            <li>Nenhum item em falta. Que maravilha! ‚ú®</li>
                        </ul>
                    </div>
                    <div class="dashboard-list-card proximos-pedidos">
                        <h3>Pr√≥ximas Entregas Imperd√≠veis! üóìÔ∏è</h3>
                        <ul id="proximosPedidosList">
                            <li>Nenhum pedido pr√≥ximo. Descanse! üò¥</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="clientes">
                <h2>Gerenciar Clientes üßë‚Äçü§ù‚Äçüßë</h2>
                <div class="section-actions">
                    <button id="addClienteBtn" class="add-button"><i class="fas fa-plus-circle"></i> Adicionar Novo Cliente</button>
                    <div class="search-container">
                        <input type="text" id="clienteSearch" placeholder="Pesquisar clientes...">
                        <button id="clearClienteSearch" class="clear-search-button">X</button>
                    </div>
                </div>
                <div class="form-container hidden" id="clienteFormContainer">
                    <h3>Detalhes do Cliente</h3>
                    <form id="clienteForm">
                        <input type="hidden" id="clienteId">
                        <label for="clienteNome">Nome:</label>
                        <input type="text" id="clienteNome" required>
                        <label for="clienteTelefone">Telefone:</label>
                        <input type="text" id="clienteTelefone" required>
                        <label for="clienteEmail">Email:</label>
                        <input type="email" id="clienteEmail">
                        <label for="clienteEndereco">Endere√ßo:</label>
                        <input type="text" id="clienteEndereco">
                        <div class="form-buttons">
                            <button type="submit">Salvar Cliente</button>
                            <button type="button" class="cancel-button" id="cancelClienteBtn">Cancelar</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <table id="clientesTable">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Telefone</th>
                                <th>Email</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="pedidos">
                <h2>Gerenciar Pedidos üìù</h2>
                <div class="section-actions">
                    <button id="addPedidoBtn" class="add-button"><i class="fas fa-plus-circle"></i> Novo Pedido</button>
                    <div class="search-container">
                        <input type="text" id="pedidoSearch" placeholder="Pesquisar pedidos...">
                        <button id="clearPedidoSearch" class="clear-search-button">X</button>
                    </div>
                </div>
                <div class="form-container hidden" id="pedidoFormContainer">
                    <h3>Detalhes do Pedido</h3>
                    <form id="pedidoForm">
                        <input type="hidden" id="pedidoId">
                        <label for="pedidoCliente">Cliente:</label>
                        <select id="pedidoCliente" required>
                            </select>
                        <label for="pedidoProduto">Produto:</label>
                        <select id="pedidoProduto">
                            </select>
                        <label for="pedidoQuantidade">Quantidade:</label>
                        <input type="number" id="pedidoQuantidade" min="1" value="1">
                        <button type="button" id="addProdutoAoPedidoBtn" class="add-small-button">Adicionar Produto ao Pedido</button>

                        <h4>Itens do Pedido:</h4>
                        <ul id="listaItensPedido">
                            </ul>
                        <p>Total do Pedido: <span id="totalPedidoDisplay">R$ 0,00</span></p>

                        <label for="pedidoDataEntrega">Data de Entrega:</label>
                        <input type="date" id="pedidoDataEntrega" required>
                        <label for="pedidoStatus">Status:</label>
                        <select id="pedidoStatus">
                            <option value="Pendente">Pendente</option>
                            <option value="Em Produ√ß√£o">Em Produ√ß√£o</option>
                            <option value="Conclu√≠do">Conclu√≠do</option>
                            <option value="Entregue">Entregue</option>
                            <option value="Cancelado">Cancelado</option>
                        </select>
                        <label for="pedidoObservacoes">Observa√ß√µes:</label>
                        <textarea id="pedidoObservacoes"></textarea>
                        <div class="form-buttons">
                            <button type="submit">Salvar Pedido</button>
                            <button type="button" class="cancel-button" id="cancelPedidoBtn">Cancelar</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <table id="pedidosTable">
                        <thead>
                            <tr>
                                <th>ID Pedido</th>
                                <th>Cliente</th>
                                <th>Data Entrega</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="produtos">
                <h2>Gerenciar Produtos Finais üéÇ</h2>
                <div class="section-actions">
                    <button id="addProdutoFinalBtn" class="add-button"><i class="fas fa-plus-circle"></i> Adicionar Novo Produto</button>
                    <div class="search-container">
                        <input type="text" id="produtoFinalSearch" placeholder="Pesquisar produtos...">
                        <button id="clearProdutoFinalSearch" class="clear-search-button">X</button>
                    </div>
                </div>
                <div class="form-container hidden" id="produtoFinalFormContainer">
                    <h3>Detalhes do Produto Final</h3>
                    <form id="produtoFinalForm">
                        <input type="hidden" id="produtoFinalId">
                        <label for="produtoFinalNome">Nome:</label>
                        <input type="text" id="produtoFinalNome" required>
                        <label for="produtoFinalPrecoVenda">Pre√ßo de Venda:</label>
                        <input type="number" id="produtoFinalPrecoVenda" step="0.01" min="0" required>

                        <h4>Ingredientes Necess√°rios:</h4>
                        <div class="add-ingrediente-form">
                            <label for="ingredienteEstoque">Ingrediente do Estoque:</label>
                            <select id="ingredienteEstoque">
                                </select>
                            <label for="quantidadeIngrediente">Quantidade (unidade do estoque):</label>
                            <input type="number" id="quantidadeIngrediente" min="0.01" step="0.01" value="1">
                            <button type="button" id="addIngredienteAoProdutoTempBtn" class="add-small-button">Adicionar Ingrediente</button>
                        </div>
                        <ul id="listaIngredientesProdutoFinal">
                            </ul>
                        <p>Custo de Produ√ß√£o Estimado: <span id="custoProducaoInput">R$ 0,00</span></p>

                        <label for="produtoFinalDescricao">Descri√ß√£o:</label>
                        <textarea id="produtoFinalDescricao"></textarea>
                        <div class="form-buttons">
                            <button type="submit">Salvar Produto</button>
                            <button type="button" class="cancel-button" id="cancelProdutoFinalBtn">Cancelar</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <table id="produtosTable">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Pre√ßo Venda</th>
                                <th>Custo Produ√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="estoque">
                <h2>Gerenciar Estoque üì¶</h2>
                <div class="section-actions">
                    <button id="addEstoqueBtn" class="add-button"><i class="fas fa-plus-circle"></i> Adicionar Novo Item</button>
                    <div class="search-container">
                        <input type="text" id="estoqueSearch" placeholder="Pesquisar itens...">
                        <button id="clearEstoqueSearch" class="clear-search-button">X</button>
                    </div>
                </div>
                <div class="form-container hidden" id="estoqueFormContainer">
                    <h3>Detalhes do Item de Estoque</h3>
                    <form id="estoqueForm">
                        <input type="hidden" id="estoqueId">
                        <label for="estoqueNome">Nome do Item:</label>
                        <input type="text" id="estoqueNome" required>
                        <label for="estoqueQuantidade">Quantidade:</label>
                        <input type="number" id="estoqueQuantidade" step="0.01" min="0" required>
                        <label for="estoqueUnidadeMedida">Unidade de Medida (ex: kg, un, L):</label>
                        <input type="text" id="estoqueUnidadeMedida" required>
                        <label for="estoqueCustoUnitario">Custo Unit√°rio (R$):</label>
                        <input type="number" id="estoqueCustoUnitario" step="0.01" min="0" required>
                        <label for="estoqueQuantidadeMinima">Qtd. M√≠nima de Alerta:</label>
                        <input type="number" id="estoqueQuantidadeMinima" step="0.01" min="0" value="0">
                        <div class="form-buttons">
                            <button type="submit">Salvar Item</button>
                            <button type="button" class="cancel-button" id="cancelEstoqueBtn">Cancelar</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <table id="estoqueTable">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Quantidade</th>
                                <th>Unidade</th>
                                <th>Custo Unit√°rio</th>
                                <th>Qtd. M√≠nima</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="despesas">
                <h2>Gerenciar Despesas üí∏</h2>
                <div class="section-actions">
                    <button id="addDespesaBtn" class="add-button"><i class="fas fa-plus-circle"></i> Adicionar Nova Despesa</button>
                    <div class="search-container">
                        <input type="text" id="despesaSearch" placeholder="Pesquisar despesas...">
                        <button id="clearDespesaSearch" class="clear-search-button">X</button>
                    </div>
                </div>
                <div class="form-container hidden" id="despesaFormContainer">
                    <h3>Detalhes da Despesa</h3>
                    <form id="despesaForm">
                        <input type="hidden" id="despesaId">
                        <label for="despesaDescricao">Descri√ß√£o:</label>
                        <input type="text" id="despesaDescricao" required>
                        <label for="despesaValor">Valor (R$):</label>
                        <input type="number" id="despesaValor" step="0.01" min="0" required>
                        <label for="despesaData">Data:</label>
                        <input type="date" id="despesaData" required>
                        <label for="despesaCategoria">Categoria:</label>
                        <input type="text" id="despesaCategoria" list="despesaCategoriasList">
                        <datalist id="despesaCategoriasList">
                            <option value="Aluguel">
                            <option value="Material de Limpeza">
                            <option value="Marketing">
                            <option value="Manuten√ß√£o">
                            <option value="Sal√°rios">
                        </datalist>
                        <div class="form-buttons">
                            <button type="submit">Salvar Despesa</button>
                            <button type="button" class="cancel-button" id="cancelDespesaBtn">Cancelar</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <table id="despesasTable">
                        <thead>
                            <tr>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                                <th>Data</th>
                                <th>Categoria</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="agenda">
                <h2>Agenda de Entregas üóìÔ∏è</h2>
                <div class="section-actions">
                    <label for="agendaClienteFilter">Filtrar por Cliente:</label>
                    <select id="agendaClienteFilter">
                        <option value="">Todos os Clientes</option>
                        </select>
                </div>
                <div class="agenda-container">
                    <div id="agendaCalendar"></div>
                    <ul id="agendaPedidosList">
                        </ul>
                </div>
            </section>
        </main>
    </div>

    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modalMessage">Tem certeza que deseja fazer isso?</p>
            <div class="modal-buttons">
                <button id="confirmBtn" class="confirm-button">Confirmar</button>
                <button id="cancelModalBtn" class="cancel-button">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Fun√ß√µes de Utilit√°rios
        const Utils = (() => {
            const formatCurrency = (value) => {
                return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
            };

            const formatDate = (dateString) => {
                const date = new Date(dateString + 'T00:00:00'); // Adiciona T00:00:00 para evitar problemas de fuso hor√°rio
                return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
            };

            const generateId = () => {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            };

            const getStorage = (key) => {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : [];
                } catch (e) {
                    console.error(`Erro ao obter dados de ${key} do localStorage:`, e);
                    return [];
                }
            };

            const setStorage = (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (e) {
                    console.error(`Erro ao salvar dados em ${key} no localStorage:`, e);
                }
            };

            const addItem = (key, item) => {
                const items = getStorage(key);
                item.id = generateId(); // Garante um ID √∫nico para cada item
                items.push(item);
                setStorage(key, items);
            };

            const editItem = (key, id, updatedItem) => {
                const items = getStorage(key);
                const index = items.findIndex(item => item.id === id);
                if (index !== -1) {
                    items[index] = { ...items[index], ...updatedItem };
                    setStorage(key, items);
                }
            };

            const deleteItem = (key, id) => {
                let items = getStorage(key);
                items = items.filter(item => item.id !== id);
                setStorage(key, items);
            };

            const getItemsCurrentMonth = (key, dateField) => {
                const items = getStorage(key);
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();

                return items.filter(item => {
                    const itemDate = new Date(item[dateField]);
                    return itemDate.getMonth() === currentMonth && itemDate.getFullYear() === currentYear;
                });
            };

            return {
                formatCurrency,
                formatDate,
                generateId,
                getStorage,
                setStorage,
                addItem,
                editItem,
                deleteItem,
                getItemsCurrentMonth
            };
        })();

        // M√≥dulo de Confirma√ß√£o
        const ConfirmationModal = (() => {
            const modal = document.getElementById('confirmationModal');
            const messageElement = document.getElementById('modalMessage');
            const confirmBtn = document.getElementById('confirmBtn');
            const cancelBtn = document.getElementById('cancelModalBtn');
            const closeButton = modal.querySelector('.close-button');
            let resolvePromise;

            const show = (message) => {
                messageElement.textContent = message;
                modal.style.display = 'flex'; // Usar flex para centralizar
                return new Promise((resolve) => {
                    resolvePromise = resolve;
                });
            };

            const hide = () => {
                modal.style.display = 'none';
            };

            confirmBtn.onclick = () => {
                resolvePromise(true);
                hide();
            };

            cancelBtn.onclick = () => {
                resolvePromise(false);
                hide();
            };

            closeButton.onclick = () => {
                resolvePromise(false);
                hide();
            };

            // Fechar modal ao clicar fora
            window.onclick = (event) => {
                if (event.target === modal) {
                    resolvePromise(false);
                    hide();
                }
            };

            return {
                show
            };
        })();

        // M√≥dulo da Aplica√ß√£o Principal
        const App = (() => {
            const navButtons = document.querySelectorAll('.nav-button');
            const sections = document.querySelectorAll('.content section');
            const splashScreen = document.getElementById('splash-screen');
            const mainApp = document.getElementById('app');

            const mostrar = (sectionId) => {
                sections.forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(sectionId).classList.add('active');

                navButtons.forEach(button => {
                    button.classList.remove('active');
                    if (button.id === `nav${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}`) {
                        button.classList.add('active');
                    }
                });

                // Chamar atualiza√ß√£o espec√≠fica da se√ß√£o
                if (sectionId === 'dashboard') {
                    Dashboard.atualizarDashboard();
                } else if (sectionId === 'clientes') {
                    Clientes.carregarClientes();
                } else if (sectionId === 'pedidos') {
                    Pedidos.carregarPedidos();
                } else if (sectionId === 'produtos') {
                    Produtos.carregarProdutosFinais();
                } else if (sectionId === 'estoque') {
                    Estoque.carregarItensEstoque();
                } else if (sectionId === 'despesas') {
                    Despesas.carregarDespesas();
                } else if (sectionId === 'agenda') {
                    Agenda.carregarAgenda();
                }
            };

            const configurarNavegacao = () => {
                navButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const sectionId = button.id.replace('nav', '').toLowerCase();
                        mostrar(sectionId);
                    });
                });
            };

            const esconderSplashScreen = () => {
                splashScreen.classList.add('hidden');
                mainApp.classList.remove('hidden');
            };

            const atualizarTudo = () => {
                // Atualiza o Dashboard sempre que algo relevante muda
                Dashboard.atualizarDashboard();
                Clientes.carregarClientes();
                Pedidos.carregarPedidos();
                Produtos.carregarProdutosFinais();
                Estoque.carregarItensEstoque();
                Despesas.carregarDespesas();
                Agenda.carregarAgenda(); // Atualiza a agenda tamb√©m
            };

            const init = () => {
                configurarNavegacao();
                // Exibe a splash screen por um tempo, depois esconde e mostra o app
                setTimeout(() => {
                    esconderSplashScreen();
                    mostrar('dashboard'); // Iniciar sempre no Dashboard
                    atualizarTudo(); // Carrega todos os dados iniciais
                }, 1000); // 1 segundo
            };

            return {
                init,
                mostrar,
                atualizarTudo // Exp√µe para que outros m√≥dulos possam chamar
            };
        })();

        // M√≥dulo Dashboard
        const Dashboard = (() => {
            const dashboardGanhos = document.getElementById('dashboardGanhos');
            const dashboardGastos = document.getElementById('dashboardGastos');
            const dashboardLucro = document.getElementById('dashboardLucro');
            const totalClientes = document.getElementById('totalClientes');
            const totalProdutosFinais = document.getElementById('totalProdutosFinais');
            const estoqueBaixoList = document.getElementById('estoqueBaixoList');
            const proximosPedidosList = document.getElementById('proximosPedidosList');

            const atualizarResumoFinanceiro = () => {
                const pedidosMes = Utils.getItemsCurrentMonth('pedidos', 'dataEntrega');
                const despesasMes = Utils.getItemsCurrentMonth('despesas', 'data');

                let ganhosTotal = 0;
                pedidosMes.forEach(pedido => {
                    if (pedido.status === 'Conclu√≠do' || pedido.status === 'Entregue') {
                        ganhosTotal += parseFloat(pedido.total || 0);
                    }
                });

                let gastosTotal = 0;
                despesasMes.forEach(despesa => {
                    gastosTotal += parseFloat(despesa.valor || 0);
                });

                const lucroTotal = ganhosTotal - gastosTotal;

                dashboardGanhos.textContent = Utils.formatCurrency(ganhosTotal);
                dashboardGastos.textContent = Utils.formatCurrency(gastosTotal);
                dashboardLucro.textContent = Utils.formatCurrency(lucroTotal);
            };

            const atualizarContadores = () => {
                const clientes = Utils.getStorage('clientes');
                const produtosFinais = Utils.getStorage('produtos');

                totalClientes.textContent = clientes.length;
                totalProdutosFinais.textContent = produtosFinais.length;
            };

            const listarEstoqueBaixo = () => {
                const estoque = Utils.getStorage('estoque');
                const itensBaixo = estoque.filter(item => parseFloat(item.quantidade) <= parseFloat(item.quantidadeMinima || 0));

                estoqueBaixoList.innerHTML = '';
                if (itensBaixo.length === 0) {
                    estoqueBaixoList.innerHTML = '<li>Nenhum item em falta. Que maravilha! ‚ú®</li>';
                } else {
                    itensBaixo.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = `${item.nome}: ${item.quantidade} ${item.unidadeMedida} (m√≠nimo: ${item.quantidadeMinima} ${item.unidadeMedida})`;
                        estoqueBaixoList.appendChild(li);
                    });
                }
            };

            const listarProximosPedidos = () => {
                const pedidos = Utils.getStorage('pedidos');
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0); // Zera o hor√°rio para compara√ß√£o de datas

                const proximos = pedidos.filter(pedido => {
                    const dataEntrega = new Date(pedido.dataEntrega + 'T00:00:00');
                    const diffTime = dataEntrega.getTime() - hoje.getTime();
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    return diffDays >= 0 && diffDays <= 7 && (pedido.status === 'Pendente' || pedido.status === 'Em Produ√ß√£o');
                }).sort((a, b) => new Date(a.dataEntrega) - new Date(b.dataEntrega));

                proximosPedidosList.innerHTML = '';
                if (proximos.length === 0) {
                    proximosPedidosList.innerHTML = '<li>Nenhum pedido pr√≥ximo. Descanse! üò¥</li>';
                } else {
                    proximos.forEach(pedido => {
                        const cliente = Utils.getStorage('clientes').find(c => c.id === pedido.clienteId);
                        const li = document.createElement('li');
                        li.textContent = `${Utils.formatDate(pedido.dataEntrega)} - Pedido ${pedido.id.substring(0, 5)} - Cliente: ${cliente ? cliente.nome : 'Desconhecido'} (${pedido.status})`;
                        proximosPedidosList.appendChild(li);
                    });
                }
            };

            const atualizarDashboard = () => {
                atualizarResumoFinanceiro();
                atualizarContadores();
                listarEstoqueBaixo();
                listarProximosPedidos();
            };

            return {
                atualizarDashboard
            };
        })();

        // M√≥dulo Clientes
        const Clientes = (() => {
            const formContainer = document.getElementById('clienteFormContainer');
            const form = document.getElementById('clienteForm');
            const clienteIdInput = document.getElementById('clienteId');
            const clienteNomeInput = document.getElementById('clienteNome');
            const clienteTelefoneInput = document.getElementById('clienteTelefone');
            const clienteEmailInput = document.getElementById('clienteEmail');
            const clienteEnderecoInput = document.getElementById('clienteEndereco');
            const addBtn = document.getElementById('addClienteBtn');
            const cancelBtn = document.getElementById('cancelClienteBtn');
            const tableBody = document.querySelector('#clientesTable tbody');
            const searchInput = document.getElementById('clienteSearch');
            const clearSearchBtn = document.getElementById('clearClienteSearch');

            const carregarClientes = (searchTerm = '') => {
                const clientes = Utils.getStorage('clientes');
                tableBody.innerHTML = '';

                const filteredClientes = clientes.filter(cliente =>
                    cliente.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    cliente.telefone.includes(searchTerm)
                );

                if (filteredClientes.length === 0 && searchTerm !== '') {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.colSpan = 4;
                    cell.textContent = 'Nenhum cliente encontrado.';
                    cell.style.textAlign = 'center';
                } else if (clientes.length === 0 && searchTerm === '') {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.colSpan = 4;
                    cell.textContent = 'Nenhum cliente cadastrado ainda. Comece adicionando um!';
                    cell.style.textAlign = 'center';
                }

                filteredClientes.forEach(cliente => {
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = cliente.nome;
                    row.insertCell(1).textContent = cliente.telefone;
                    row.insertCell(2).textContent = cliente.email;

                    const actionsCell = row.insertCell(3);
                    const editButton = document.createElement('button');
                    editButton.textContent = 'Editar';
                    editButton.classList.add('edit-button');
                    editButton.addEventListener('click', () => prepararEdicao(cliente.id));

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Excluir';
                    deleteButton.classList.add('delete-button');
                    deleteButton.addEventListener('click', () => excluirCliente(cliente.id));

                    actionsCell.appendChild(editButton);
                    actionsCell.appendChild(deleteButton);
                });
            };

            const mostrarFormulario = () => {
                formContainer.classList.remove('hidden');
                form.reset();
                clienteIdInput.value = '';
            };

            const esconderFormulario = () => {
                formContainer.classList.add('hidden');
                form.reset();
                clienteIdInput.value = '';
            };

            const salvarCliente = (event) => {
                event.preventDefault();
                const cliente = {
                    nome: clienteNomeInput.value,
                    telefone: clienteTelefoneInput.value,
                    email: clienteEmailInput.value,
                    endereco: clienteEnderecoInput.value
                };

                if (clienteIdInput.value) {
                    Utils.editItem('clientes', clienteIdInput.value, cliente);
                } else {
                    Utils.addItem('clientes', cliente);
                }
                esconderFormulario();
                App.atualizarTudo();
            };

            const prepararEdicao = (id) => {
                const clientes = Utils.getStorage('clientes');
                const cliente = clientes.find(c => c.id === id);
                if (cliente) {
                    clienteIdInput.value = cliente.id;
                    clienteNomeInput.value = cliente.nome;
                    clienteTelefoneInput.value = cliente.telefone;
                    clienteEmailInput.value = cliente.email;
                    clienteEnderecoInput.value = cliente.endereco;
                    mostrarFormulario();
                }
            };

            const excluirCliente = async (id) => {
                const confirm = await ConfirmationModal.show('Tem certeza que deseja excluir este cliente? Isso remover√° todos os pedidos associados a ele.');
                if (confirm) {
                    Utils.deleteItem('clientes', id);
                    // Remover pedidos associados
                    let pedidos = Utils.getStorage('pedidos');
                    pedidos = pedidos.filter(pedido => pedido.clienteId !== id);
                    Utils.setStorage('pedidos', pedidos);
                    App.atualizarTudo();
                }
            };

            // Event Listeners
            addBtn.addEventListener('click', mostrarFormulario);
            cancelBtn.addEventListener('click', esconderFormulario);
            form.addEventListener('submit', salvarCliente);
            searchInput.addEventListener('input', (e) => carregarClientes(e.target.value));
            clearSearchBtn.addEventListener('click', () => {
                searchInput.value = '';
                carregarClientes();
            });

            return {
                carregarClientes,
                prepararEdicao // Expor para uso em outros m√≥dulos se necess√°rio (ex: agenda)
            };
        })();

        // M√≥dulo Pedidos
        const Pedidos = (() => {
            const formContainer = document.getElementById('pedidoFormContainer');
            const form = document.getElementById('pedidoForm');
            const pedidoIdInput = document.getElementById('pedidoId');
            const pedidoClienteSelect = document.getElementById('pedidoCliente');
            const pedidoProdutoSelect = document.getElementById('pedidoProduto');
            const pedidoQuantidadeInput = document.getElementById('pedidoQuantidade');
            const addProdutoAoPedidoBtn = document.getElementById('addProdutoAoPedidoBtn');
            const listaItensPedidoUl = document.getElementById('listaItensPedido');
            const totalPedidoDisplay = document.getElementById('totalPedidoDisplay');
            const pedidoDataEntregaInput = document.getElementById('pedidoDataEntrega');
            const pedidoStatusSelect = document.getElementById('pedidoStatus');
            const pedidoObservacoesTextarea = document.getElementById('pedidoObservacoes');
            const addBtn = document.getElementById('addPedidoBtn');
            const cancelBtn = document.getElementById('cancelPedidoBtn');
            const tableBody = document.querySelector('#pedidosTable tbody');
            const searchInput = document.getElementById('pedidoSearch');
            const clearSearchBtn = document.getElementById('clearPedidoSearch');

            let itensPedidoTemporarios = []; // Armazena os itens para o pedido atual

            const carregarPedidos = (searchTerm = '') => {
                const pedidos = Utils.getStorage('pedidos');
                const clientes = Utils.getStorage('clientes');
                tableBody.innerHTML = '';

                const filteredPedidos = pedidos.filter(pedido => {
                    const cliente = clientes.find(c => c.id === pedido.clienteId);
                    const clienteNome = cliente ? cliente.nome.toLowerCase() : '';
                    const pedidoIdPartial = pedido.id ? pedido.id.substring(0, 5).toLowerCase() : '';
                    const searchTermLower = searchTerm.toLowerCase();

                    return clienteNome.includes(searchTermLower) ||
                           pedidoIdPartial.includes(searchTermLower) ||
                           pedido.status.toLowerCase().includes(searchTermLower);
                });

                if (filteredPedidos.length === 0 && searchTerm !== '') {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.colSpan = 6;
                    cell.textContent = 'Nenhum pedido encontrado.';
                    cell.style.textAlign = 'center';
                } else if (pedidos.length === 0 && searchTerm === '') {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.colSpan = 6;
                    cell.textContent = 'Nenhum pedido cadastrado ainda. Que tal criar um?';
                    cell.style.textAlign = 'center';
                }

                filteredPedidos.forEach(pedido => {
                    const row = tableBody.insertRow();
                    const cliente = clientes.find(c => c.id === pedido.clienteId);
                    row.insertCell(0).textContent = pedido.id.substring(0, 8); // ID reduzido
                    row.insertCell(1).textContent = cliente ? cliente.nome : 'Cliente Desconhecido';
                    row.insertCell(2).textContent = Utils.formatDate(pedido.dataEntrega);
                    row.insertCell(3).textContent = Utils.formatCurrency(pedido.total || 0);
                    row.insertCell(4).textContent = pedido.status;

                    const actionsCell = row.insertCell(5);
                    const editButton = document.createElement('button');
                    editButton.textContent = 'Editar';
                    editButton.classList.add('edit-button');
                    editButton.addEventListener('click', () => prepararEdicao(pedido.id));

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Excluir';
                    deleteButton.classList.add('delete-button');
                    deleteButton.addEventListener('click', () => excluirPedido(pedido.id));

                    actionsCell.appendChild(editButton);
                    actionsCell.appendChild(deleteButton);
                });
            };

            const preencherSelectClientes = () => {
                const clientes = Utils.getStorage('clientes');
                pedidoClienteSelect.innerHTML = '<option value="">Selecione um Cliente</option>';
                clientes.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = cliente.nome;
                    pedidoClienteSelect.appendChild(option);
                });
            };

            const preencherSelectProdutos = () => {
                const produtos = Utils.getStorage('produtos');
                pedidoProdutoSelect.innerHTML = '<option value="">Selecione um Produto Final</option>';
                produtos.forEach(produto => {
                    const option = document.createElement('option');
                    option.value = produto.id;
                    option.textContent = produto.nome + ' - ' + Utils.formatCurrency(produto.precoVenda);
                    pedidoProdutoSelect.appendChild(option);
                });
            };

            const calcularTotalPedido = () => {
                let total = 0;
                itensPedidoTemporarios.forEach(item => {
                    total += (parseFloat(item.precoVenda || 0) * parseFloat(item.quantidade || 0));
                });
                totalPedidoDisplay.textContent = Utils.formatCurrency(total);
                return total;
            };

            const adicionarProdutoAoPedidoTemp = () => {
                const produtoId = pedidoProdutoSelect.value;
                const quantidade = parseFloat(pedidoQuantidadeInput.value);

                if (!produtoId || quantidade <= 0) {
                    alert('Por favor, selecione um produto e insira uma quantidade v√°lida.');
                    return;
                }

                const produto = Utils.getStorage('produtos').find(p => p.id === produtoId);
                if (produto) {
                    const itemExistenteIndex = itensPedidoTemporarios.findIndex(item => item.produtoId === produtoId);

                    if (itemExistenteIndex !== -1) {
                        // Atualiza quantidade se o item j√° existe
                        itensPedidoTemporarios[itemExistenteIndex].quantidade += quantidade;
                    } else {
                        // Adiciona novo item
                        itensPedidoTemporarios.push({
                            produtoId: produto.id,
                            nome: produto.nome,
                            precoVenda: parseFloat(produto.precoVenda),
                            quantidade: quantidade
                        });
                    }

                    renderizarItensPedidoTemp();
                    calcularTotalPedido();
                    pedidoProdutoSelect.value = '';
                    pedidoQuantidadeInput.value = '1';
                } else {
                    alert('Produto n√£o encontrado.');
                }
            };

            const removerProdutoDoPedidoTemp = (index) => {
                itensPedidoTemporarios.splice(index, 1);
                renderizarItensPedidoTemp();
                calcularTotalPedido();
            };

            const renderizarItensPedidoTemp = () => {
                listaItensPedidoUl.innerHTML = '';
                if (itensPedidoTemporarios.length === 0) {
                    const li = document.createElement('li');
                    li.textContent = 'Nenhum produto adicionado ao pedido.';
                    listaItensPedidoUl.appendChild(li);
                    return;
                }
                itensPedidoTemporarios.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        ${item.nome} (${item.quantidade}x) - ${Utils.formatCurrency(item.precoVenda * item.quantidade)}
                        <button type="button" class="remove-item-btn" data-index="${index}">&times;</button>
                    `;
                    listaItensPedidoUl.appendChild(li);
                });

                listaItensPedidoUl.querySelectorAll('.remove-item-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.target.dataset.index);
                        removerProdutoDoPedidoTemp(index);
                    });
                });
            };


            const mostrarFormulario = () => {
                formContainer.classList.remove('hidden');
                form.reset();
                pedidoIdInput.value = '';
                itensPedidoTemporarios = []; // Limpa os itens tempor√°rios ao abrir novo formul√°rio
                renderizarItensPedidoTemp();
                calcularTotalPedido();
                preencherSelectClientes();
                preencherSelectProdutos();
            };

            const esconderFormulario = () => {
                formContainer.classList.add('hidden');
                form.reset();
                pedidoIdInput.value = '';
                itensPedidoTemporarios = [];
                renderizarItensPedidoTemp(); // Garante que a lista esteja limpa no display
                calcularTotalPedido();
            };

            const salvarPedido = (event) => {
                event.preventDefault();

                if (itensPedidoTemporarios.length === 0) {
                    alert('Por favor, adicione pelo menos um produto ao pedido.');
                    return;
                }

                const pedido = {
                    clienteId: pedidoClienteSelect.value,
                    itens: itensPedidoTemporarios,
                    total: calcularTotalPedido(), // Garante que o total seja calculado no momento do salvamento
                    dataEntrega: pedidoDataEntregaInput.value,
                    status: pedidoStatusSelect.value,
                    observacoes: pedidoObservacoesTextarea.value
                };

                if (pedidoIdInput.value) {
                    Utils.editItem('pedidos', pedidoIdInput.value, pedido);
                } else {
                    Utils.addItem('pedidos', pedido);
                }
                esconderFormulario();
                App.atualizarTudo();
            };

            const prepararEdicao = (id) => {
                const pedidos = Utils.getStorage('pedidos');
                const pedido = pedidos.find(p => p.id === id);
                if (pedido) {
                    pedidoIdInput.value = pedido.id;
                    pedidoClienteSelect.value = pedido.clienteId;
                    pedidoDataEntregaInput.value = pedido.dataEntrega;
                    pedidoStatusSelect.value = pedido.status;
                    pedidoObservacoesTextarea.value = pedido.observacoes;
                    itensPedidoTemporarios = [...pedido.itens]; // Copia os itens existentes
                    renderizarItensPedidoTemp();
                    calcularTotalPedido();
                    mostrarFormulario();
                }
            };

            const excluirPedido = async (id) => {
                const confirm = await ConfirmationModal.show('Tem certeza que deseja excluir este pedido?');
                if (confirm) {
                    Utils.deleteItem('pedidos', id);
                    App.atualizarTudo();
                }
            };

            // Event Listeners
            addBtn.addEventListener('click', mostrarFormulario);
            cancelBtn.addEventListener('click', esconderFormulario);
            form.addEventListener('submit', salvarPedido);
            addProdutoAoPedidoBtn.addEventListener('click', adicionarProdutoAoPedidoTemp);
            searchInput.addEventListener('input', (e) => carregarPedidos(e.target.value));
            clearSearchBtn.addEventListener('click', () => {
                searchInput.value = '';
                carregarPedidos();
            });


            return {
                carregarPedidos,
                prepararEdicao
            };
        })();

        // M√≥dulo Produtos Finais
        const Produtos = (() => {
            const formContainer = document.getElementById('produtoFinalFormContainer');
            const form = document.getElementById('produtoFinalForm');
            const produtoFinalIdInput = document.getElementById('produtoFinalId');
            const produtoFinalNomeInput = document.getElementById('produtoFinalNome');
            const produtoFinalPrecoVendaInput = document.getElementById('produtoFinalPrecoVenda');
            const ingredienteEstoqueSelect = document.getElementById('ingredienteEstoque');
            const quantidadeIngredienteInput = document.getElementById('quantidadeIngrediente');
            const addIngredienteAoProdutoTempBtn = document.getElementById('addIngredienteAoProdutoTempBtn');
            const listaIngredientesProdutoFinalUl = document.getElementById('listaIngredientesProdutoFinal');
            const custoProducaoInput = document.getElementById('custoProducaoInput');
            const produtoFinalDescricaoTextarea = document.getElementById('produtoFinalDescricao');
            const addBtn = document.getElementById('addProdutoFinalBtn');
            const cancelBtn = document.getElementById('cancelProdutoFinalBtn');
            const tableBody = document.querySelector('#produtosTable tbody');
            const searchInput = document.getElementById('produtoFinalSearch');
            const clearSearchBtn = document.getElementById('clearProdutoFinalSearch');


            let ingredientesTemporarios = []; // Armazena ingredientes para o produto atual

            const carregarProdutosFinais = (searchTerm = '') => {
                const produtos = Utils.getStorage('produtos');
                tableBody.innerHTML = '';

                const filteredProdutos = produtos.filter(produto =>
                    produto.nome.toLowerCase().includes(searchTerm.toLowerCase())
                );

                if (filteredProdutos.length === 0 && searchTerm !== '') {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.colSpan = 4;
                    cell.textContent = 'Nenhum produto final encontrado.';
                    cell.style.textAlign = 'center';
                } else if (produtos.length === 0 && searchTerm === '') {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.colSpan = 4;
                    cell.textContent = 'Nenhum produto final cadastrado ainda. Comece a criar suas del√≠cias!';
                    cell.style.textAlign = 'center';
                }

                filteredProdutos.forEach(produto => {
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = produto.nome;
                    row.insertCell(1).textContent = Utils.formatCurrency(produto.precoVenda || 0);
                    row.insertCell(2).textContent = Utils.formatCurrency(produto.custoProducao || 0);

                    const actionsCell = row.insertCell(3);
                    const editButton = document.createElement('button');
                    editButton.textContent = 'Editar';
                    editButton.classList.add('edit-button');
                    editButton.addEventListener('click', () => prepararEdicaoProdutoFinal(produto.id));

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Excluir';
                    deleteButton.classList.add('delete-button');
                    deleteButton.addEventListener('click', () => excluirProdutoFinal(produto.id));

                    actionsCell.appendChild(editButton);
                    actionsCell.appendChild(deleteButton);
                });
            };

            const preencherSelectIngredientesEstoque = () => {
                const estoque = Utils.getStorage('estoque');
                ingredienteEstoqueSelect.innerHTML = '<option value="">Selecione um Ingrediente</option>';
                estoque.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.nome} (${item.quantidade} ${item.unidadeMedida}) - ${Utils.formatCurrency(item.custoUnitario)}`;
                    ingredienteEstoqueSelect.appendChild(option);
                });
            };

            const calcularCustoProducaoProdutoFinal = () => {
                let custoTotal = 0;
                ingredientesTemporarios.forEach(ingrediente => {
                    custoTotal += (parseFloat(ingrediente.custoUnitario || 0) * parseFloat(ingrediente.quantidade || 0));
                });
                custoProducaoInput.textContent = Utils.formatCurrency(custoTotal);
                return custoTotal;
            };

            const adicionarIngredienteAoProdutoTemp = () => {
                const ingredienteId = ingredienteEstoqueSelect.value;
                const quantidade = parseFloat(quantidadeIngredienteInput.value);

                if (!ingredienteId || quantidade <= 0) {
                    alert('Por favor, selecione um ingrediente e insira uma quantidade v√°lida.');
                    return;
                }

                const itemEstoque = Utils.getStorage('estoque').find(item => item.id === ingredienteId);
                if (itemEstoque) {
                    const itemExistenteIndex = ingredientesTemporarios.findIndex(item => item.ingredienteId === ingredienteId);

                    if (itemExistenteIndex !== -1) {
                        ingredientesTemporarios[itemExistenteIndex].quantidade += quantidade;
                    } else {
                        ingredientesTemporarios.push({
                            ingredienteId: itemEstoque.id,
                            nome: itemEstoque.nome,
                            quantidade: quantidade, // <-- CORRE√á√ÉO: "quantidade"
                            custoUnitario: parseFloat(itemEstoque.custoUnitario || 0)
                        });
                    }

                    renderizarIngredientesProdutoFinalTemp();
                    calcularCustoProducaoProdutoFinal();
                    ingredienteEstoqueSelect.value = '';
                    quantidadeIngredienteInput.value = '1';
                } else {
                    alert('Ingrediente n√£o encontrado no estoque.');
                }
            };

            const removerIngredienteDoProdutoTemp = (index) => {
                ingredientesTemporarios.splice(index, 1);
                renderizarIngredientesProdutoFinalTemp();
                calcularCustoProducaoProdutoFinal();
            };

            const renderizarIngredientesProdutoFinalTemp = () => {
                listaIngredientesProdutoFinalUl.innerHTML = '';
                if (ingredientesTemporarios.length === 0) {
                    const li = document.createElement('li');
                    li.textContent = 'Nenhum ingrediente adicionado.';
                    listaIngredientesProdutoFinalUl.appendChild(li);
                    return;
                }
                ingredientesTemporarios.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        ${item.nome} (${item.quantidade}x) - ${Utils.formatCurrency(item.custoUnitario * item.quantidade)}
                        <button type="button" class="remove-item-btn" data-index="${index}">&times;</button>
                    `;
                    listaIngredientesProdutoFinalUl.appendChild(li);
                });

                listaIngredientesProdutoFinalUl.querySelectorAll('.remove-item-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.target.dataset.index);
                        removerIngredienteDoProdutoTemp(index);
                    });
                });
            };

            const mostrarFormulario = () => {
                formContainer.classList.remove('hidden');
                form.reset();
                produtoFinalIdInput.value = '';
                ingredientesTemporarios = []; // Limpa ingredientes tempor√°rios
                renderizarIngredientesProdutoFinalTemp();
                calcularCustoProducaoProdutoFinal();
                preencherSelectIngredientesEstoque();
            };

            const esconderFormulario = () => {
                formContainer.classList.add('hidden');
                form.reset();
                produtoFinalIdInput.value = '';
                ingredientesTemporarios = [];
                renderizarIngredientesProdutoFinalTemp();
                custoProducaoInput.textContent = Utils.formatCurrency(0); // Limpar display do custo
            };

            const salvarProdutoFinal = (event) => {
                event.preventDefault();

                if (ingredientesTemporarios.length === 0) {
                    alert('Por favor, adicione pelo menos um ingrediente ao produto final.');
                    return;
                }

                const produto = {
                    nome: produtoFinalNomeInput.value,
                    precoVenda: parseFloat(produtoFinalPrecoVendaInput.value),
                    ingredientes: ingredientesTemporarios,
                    custoProducao: calcularCustoProducaoProdutoFinal(), // Calcula o custo final
                    descricao: produtoFinalDescricaoTextarea.value
                };

                if (produtoFinalIdInput.value) {
                    Utils.editItem('produtos', produtoFinalIdInput.value, produto);
                } else {
                    Utils.addItem('produtos', produto);
                }
                esconderFormulario();
                App.atualizarTudo();
            };

            const prepararEdicaoProdutoFinal = (id) => {
                const produtos = Utils.getStorage('produtos');
                const produto = produtos.find(p => p.id === id);
                if (produto) {
                    produtoFinalIdInput.value = produto.id;
                    produtoFinalNomeInput.value = produto.nome;
                    produtoFinalPrecoVendaInput.value = produto.precoVenda;
                    produtoFinalDescricaoTextarea.value = produto.descricao;
                    ingredientesTemporarios = [...produto.ingredientes]; // Copia os ingredientes existentes
                    renderizarIngredientesProdutoFinalTemp();
                    calcularCustoProducaoProdutoFinal(); // Atualiza o custo de produ√ß√£o para exibi√ß√£o na edi√ß√£o
                    mostrarFormulario();
                } else {
                    // Se produto for null (cancelamento), limpa o campo de custo
                    custoProducaoInput.textContent = Utils.formatCurrency(0);
                }
            };

            const excluirProdutoFinal = async (id) => {
                const confirm = await ConfirmationModal.show('Tem certeza que deseja excluir este produto final?');
                if (confirm) {
                    Utils.deleteItem('produtos', id);
                    App.atualizarTudo();
                }
            };

            // Event Listeners
            addBtn.addEventListener('click', mostrarFormulario);
            cancelBtn.addEventListener('click', esconderFormulario);
            form.addEventListener('submit', salvarProdutoFinal);
            addIngredienteAoProdutoTempBtn.addEventListener('click', adicionarIngredienteAoProdutoTemp);
            searchInput.addEventListener('input', (e) => carregarProdutosFinais(e.target.value));
            clearSearchBtn.addEventListener('click', () => {
                searchInput.value = '';
                carregarProdutosFinais();
            });

            return {
                carregarProdutosFinais,
                prepararEdicaoProdutoFinal // Expor para uso em outros m√≥dulos se necess√°rio
            };
        })();

        // M√≥dulo Estoque
        const Estoque = (() => {
            const formContainer = document.getElementById('estoqueFormContainer');
            const form = document.getElementById('estoqueForm');
            const estoqueIdInput = document.getElementById('estoqueId');
            const estoqueNomeInput = document.getElementById('estoqueNome');
            const estoqueQuantidadeInput = document.getElementById('estoqueQuantidade');
            const estoqueUnidadeMedidaInput = document.getElementById('estoqueUnidadeMedida');
            const estoqueCustoUnitarioInput = document.getElementById('estoqueCustoUnitario');
            const estoqueQuantidadeMinimaInput = document.getElementById('estoqueQuantidadeMinima');
            const addBtn = document.getElementById('addEstoqueBtn');
            const cancelBtn = document.getElementById('cancelEstoqueBtn');
            const tableBody = document.querySelector('#estoqueTable tbody');
            const searchInput = document.getElementById('estoqueSearch');
            const clearSearchBtn = document.getElementById('clearEstoqueSearch');

            const carregarItensEstoque = (searchTerm = '') => {
                const estoque = Utils.getStorage('estoque');
                tableBody.innerHTML = '';

                const filteredEstoque = estoque.filter(item =>
                    item.nome.toLowerCase().includes(searchTerm.toLowerCase())
                );

                if (filteredEstoque.length === 0 && searchTerm !== '') {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.colSpan = 6;
                    cell.textContent = 'Nenhum item de estoque encontrado.';
                    cell.style.textAlign = 'center';
                } else if (estoque.length === 0 && searchTerm === '') {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.colSpan = 6;
                    cell.textContent = 'Seu estoque est√° vazio! Adicione seus primeiros ingredientes.';
                    cell.style.textAlign = 'center';
                }

                filteredEstoque.forEach(item => {
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = item.nome;
                    row.insertCell(1).textContent = parseFloat(item.quantidade);
                    row.insertCell(2).textContent = item.unidadeMedida;
                    row.insertCell(3).textContent = Utils.formatCurrency(item.custoUnitario || 0);
                    row.insertCell(4).textContent = parseFloat(item.quantidadeMinima);

                    const actionsCell = row.insertCell(5);
                    const editButton = document.createElement('button');
                    editButton.textContent = 'Editar';
                    editButton.classList.add('edit-button');
                    editButton.addEventListener('click', () => prepararEdicao(item.id));

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Excluir';
                    deleteButton.classList.add('delete-button');
                    deleteButton.addEventListener('click', () => excluirItemEstoque(item.id));

                    actionsCell.appendChild(editButton);
                    actionsCell.appendChild(deleteButton);
                });
            };

            const mostrarFormulario = () => {
                formContainer.classList.remove('hidden');
                form.reset();
                estoqueIdInput.value = '';
            };

            const esconderFormulario = () => {
                formContainer.classList.add('hidden');
                form.reset();
                estoqueIdInput.value = '';
            };

            const salvarItemEstoque = (event) => {
                event.preventDefault();
                const item = {
                    nome: estoqueNomeInput.value,
                    quantidade: parseFloat(estoqueQuantidadeInput.value),
                    unidadeMedida: estoqueUnidadeMedidaInput.value,
                    custoUnitario: parseFloat(estoqueCustoUnitarioInput.value),
                    quantidadeMinima: parseFloat(estoqueQuantidadeMinimaInput.value)
                };

                if (estoqueIdInput.value) {
                    Utils.editItem('estoque', estoqueIdInput.value, item);
                } else {
                    Utils.addItem('estoque', item);
                }
                esconderFormulario();
                App.atualizarTudo();
            };

            const prepararEdicao = (id) => {
                const estoque = Utils.getStorage('estoque');
                const item = estoque.find(i => i.id === id);
                if (item) {
                    estoqueIdInput.value = item.id;
                    estoqueNomeInput.value = item.nome;
                    estoqueQuantidadeInput.value = item.quantidade;
                    estoqueUnidadeMedidaInput.value = item.unidadeMedida;
                    estoqueCustoUnitarioInput.value = item.custoUnitario;
                    estoqueQuantidadeMinimaInput.value = item.quantidadeMinima;
                    mostrarFormulario();
                }
            };

            const excluirItemEstoque = async (id) => {
                const confirm = await ConfirmationModal.show('Tem certeza que deseja excluir este item do estoque?');
                if (confirm) {
                    Utils.deleteItem('estoque', id);
                    App.atualizarTudo();
                }
            };

            // Event Listeners
            addBtn.addEventListener('click', mostrarFormulario);
            cancelBtn.addEventListener('click', esconderFormulario);
            form.addEventListener('submit', salvarItemEstoque);
            searchInput.addEventListener('input', (e) => carregarItensEstoque(e.target.value));
            clearSearchBtn.addEventListener('click', () => {
                searchInput.value = '';
                carregarItensEstoque();
            });

            return {
                carregarItensEstoque
            };
        })();

        // M√≥dulo Despesas
        const Despesas = (() => {
            const formContainer = document.getElementById('despesaFormContainer');
            const form = document.getElementById('despesaForm');
            const despesaIdInput = document.getElementById('despesaId');
            const despesaDescricaoInput = document.getElementById('despesaDescricao');
            const despesaValorInput = document.getElementById('despesaValor');
            const despesaDataInput = document.getElementById('despesaData');
            const despesaCategoriaInput = document.getElementById('despesaCategoria');
            const addBtn = document.getElementById('addDespesaBtn');
            const cancelBtn = document.getElementById('cancelDespesaBtn');
            const tableBody = document.querySelector('#despesasTable tbody');
            const searchInput = document.getElementById('despesaSearch');
            const clearSearchBtn = document.getElementById('clearDespesaSearch');

            const carregarDespesas = (searchTerm = '') => {
                const despesas = Utils.getStorage('despesas');
                tableBody.innerHTML = '';

                const filteredDespesas = despesas.filter(despesa =>
                    despesa.descricao.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    despesa.categoria.toLowerCase().includes(searchTerm.toLowerCase())
                );

                if (filteredDespesas.length === 0 && searchTerm !== '') {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.colSpan = 5;
                    cell.textContent = 'Nenhuma despesa encontrada.';
                    cell.style.textAlign = 'center';
                } else if (despesas.length === 0 && searchTerm === '') {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell(0);
                    cell.colSpan = 5;
                    cell.textContent = 'Nenhuma despesa registrada ainda. √â hora de anotar os gastos!';
                    cell.style.textAlign = 'center';
                }

                filteredDespesas.forEach(despesa => {
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = despesa.descricao;
                    row.insertCell(1).textContent = Utils.formatCurrency(despesa.valor || 0);
                    row.insertCell(2).textContent = Utils.formatDate(despesa.data);
                    row.insertCell(3).textContent = despesa.categoria;

                    const actionsCell = row.insertCell(4);
                    const editButton = document.createElement('button');
                    editButton.textContent = 'Editar';
                    editButton.classList.add('edit-button');
                    editButton.addEventListener('click', () => prepararEdicao(despesa.id));

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Excluir';
                    deleteButton.classList.add('delete-button');
                    deleteButton.addEventListener('click', () => excluirDespesa(despesa.id));

                    actionsCell.appendChild(editButton);
                    actionsCell.appendChild(deleteButton);
                });
            };

            const mostrarFormulario = () => {
                formContainer.classList.remove('hidden');
                form.reset();
                despesaIdInput.value = '';
                // Define a data atual como padr√£o
                const today = new Date().toISOString().split('T')[0];
                despesaDataInput.value = today;
            };

            const esconderFormulario = () => {
                formContainer.classList.add('hidden');
                form.reset();
                despesaIdInput.value = '';
            };

            const salvarDespesa = (event) => {
                event.preventDefault();
                const despesa = {
                    descricao: despesaDescricaoInput.value,
                    valor: parseFloat(despesaValorInput.value),
                    data: despesaDataInput.value,
                    categoria: despesaCategoriaInput.value
                };

                if (despesaIdInput.value) {
                    Utils.editItem('despesas', despesaIdInput.value, despesa);
                } else {
                    Utils.addItem('despesas', despesa);
                }
                esconderFormulario();
                App.atualizarTudo();
            };

            const prepararEdicao = (id) => {
                const despesas = Utils.getStorage('despesas');
                const despesa = despesas.find(d => d.id === id);
                if (despesa) {
                    despesaIdInput.value = despesa.id;
                    despesaDescricaoInput.value = despesa.descricao;
                    despesaValorInput.value = despesa.valor;
                    despesaDataInput.value = despesa.data;
                    despesaCategoriaInput.value = despesa.categoria;
                    mostrarFormulario();
                }
            };

            const excluirDespesa = async (id) => {
                const confirm = await ConfirmationModal.show('Tem certeza que deseja excluir esta despesa?');
                if (confirm) {
                    Utils.deleteItem('despesas', id);
                    App.atualizarTudo();
                }
            };

            // Event Listeners
            addBtn.addEventListener('click', mostrarFormulario);
            cancelBtn.addEventListener('click', esconderFormulario);
            form.addEventListener('submit', salvarDespesa);
            searchInput.addEventListener('input', (e) => carregarDespesas(e.target.value));
            clearSearchBtn.addEventListener('click', () => {
                searchInput.value = '';
                carregarDespesas();
            });

            return {
                carregarDespesas
            };
        })();

        // M√≥dulo Agenda
        const Agenda = (() => {
            const agendaPedidosList = document.getElementById('agendaPedidosList');
            const agendaClienteFilter = document.getElementById('agendaClienteFilter');

            const carregarAgenda = (filterClienteId = '') => {
                const pedidos = Utils.getStorage('pedidos');
                const clientes = Utils.getStorage('clientes');

                agendaPedidosList.innerHTML = ''; // Limpa a lista antes de recarregar

                let filteredPedidos = pedidos;
                if (filterClienteId) {
                    filteredPedidos = pedidos.filter(pedido => pedido.clienteId === filterClienteId);
                }

                // Ordenar pedidos por data de entrega
                filteredPedidos.sort((a, b) => new Date(a.dataEntrega) - new Date(b.dataEntrega));

                if (filteredPedidos.length === 0) {
                    const li = document.createElement('li');
                    li.textContent = 'Nenhum pedido agendado para este filtro. ü•≥';
                    agendaPedidosList.appendChild(li);
                    return;
                }

                filteredPedidos.forEach(pedido => {
                    const cliente = clientes.find(c => c.id === pedido.clienteId);
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <div>
                            <strong>${Utils.formatDate(pedido.dataEntrega)}</strong> - Pedido ${pedido.id.substring(0, 5)}
                            <br>
                            Cliente: ${cliente ? cliente.nome : 'Desconhecido'} - ${Utils.formatCurrency(pedido.total)}
                        </div>
                        <span>Status: ${pedido.status}</span>
                    `;
                    agendaPedidosList.appendChild(li);
                });
            };

            const preencherFiltroClientes = () => {
                const clientes = Utils.getStorage('clientes');
                agendaClienteFilter.innerHTML = '<option value="">Todos os Clientes</option>';
                clientes.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = cliente.nome;
                    agendaClienteFilter.appendChild(option);
                });
            };

            // Event Listeners
            agendaClienteFilter.addEventListener('change', (e) => {
                carregarAgenda(e.target.value);
            });

            return {
                carregarAgenda,
                preencherFiltroClientes // Pode ser √∫til chamar isso no init da Agenda
            };
        })();

        // Inicializa o App quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
            Agenda.preencherFiltroClientes(); // Preenche o filtro da agenda ao iniciar
        });
    </script>
</body>
</html>
